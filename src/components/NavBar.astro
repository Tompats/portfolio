---
import ThemeToggle from './ThemeToggle.astro';
import { withBase, basePath } from '../utils/url';

const links = [
  { href: '/', label: 'Home' },
  { href: '/projects', label: 'Projects' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
];

const rawPath = Astro.url.pathname.replace(/\/?$/, '') || '/';
const effectiveBase = basePath || '';
const pathname = effectiveBase && rawPath.startsWith(effectiveBase) ? rawPath.slice(effectiveBase.length) || '/' : rawPath || '/';
---
<header class="pointer-events-auto sticky top-0 z-30 px-4 pt-6 sm:px-10 lg:px-16">
  <div class="frosted-panel relative flex items-center justify-between border border-white/5 px-5 py-4">
    <div class="pointer-events-none absolute inset-0 rounded-[28px] border border-white/5 opacity-30"></div>
    <a href={withBase('/')} class="relative z-10 flex items-center gap-3" aria-label="Thomas Patsanis home">
      <span
        class="grid h-12 w-12 place-items-center rounded-2xl border border-[var(--border-strong)] bg-surface/40 font-display text-lg font-semibold text-[var(--text)] shadow-brass-ring"
      >
        TP
      </span>
      <div>
        <p class="text-[11px] uppercase tracking-[0.7em] text-[var(--muted)]">Thomas Patsanis</p>
        <p class="text-xs text-[var(--muted)]">Full-Stack Explorer</p>
      </div>
    </a>
    <nav class="relative z-10 hidden items-center gap-6 text-xs font-semibold uppercase tracking-[0.35em] text-[var(--muted)] lg:flex">
      {links.map((link) => (
        <a
          href={withBase(link.href)}
          class={`group relative pb-2 transition-colors ${pathname === link.href ? 'text-[var(--accent)]' : 'hover:text-[var(--accent)]'}`}
        >
          {link.label}
          <span
            class={`absolute left-1/2 top-full h-px w-8 -translate-x-1/2 bg-gradient-to-r from-transparent via-[var(--brass)] to-transparent transition-opacity ${pathname === link.href ? 'opacity-100' : 'opacity-0 group-hover:opacity-70'}`}
          ></span>
        </a>
      ))}
      <ThemeToggle />
    </nav>
    <button class="relative z-10 lg:hidden" id="nav-toggle" aria-expanded="false" aria-controls="mobile-menu" type="button">
      <div class="flex h-11 w-11 items-center justify-center rounded-2xl border border-[var(--border)] bg-surface/20 text-[var(--text)]">
        <span class="sr-only">Toggle navigation</span>
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
        </svg>
      </div>
    </button>
  </div>
  <div
    id="mobile-menu"
    class="frosted-panel mt-3 hidden flex-col gap-4 border border-white/10 px-6 py-6 text-sm font-semibold uppercase tracking-[0.35em] text-[var(--muted)] lg:hidden"
  >
    {links.map((link) => (
      <a href={withBase(link.href)} class={`pb-1 ${pathname === link.href ? 'text-[var(--accent)]' : ''}`}>{link.label}</a>
    ))}
    <div class="pt-3">
      <ThemeToggle />
    </div>
  </div>
  <script type="module" is:inline>
    const toggle = document.getElementById('nav-toggle');
    const menu = document.getElementById('mobile-menu');
    toggle?.addEventListener('click', () => {
      if (!menu) return;
      const isHidden = menu.classList.toggle('hidden');
      toggle.setAttribute('aria-expanded', (!isHidden).toString());
    });
  </script>
</header>
