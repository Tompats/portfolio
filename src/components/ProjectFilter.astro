---
import ProjectCard from './ProjectCard.astro';
import type { Project, ProjectCategory } from '../content/data';

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
const filters: Array<'All' | ProjectCategory> = ['All', 'Full-Stack', 'Mobile', 'Web', 'Backend'];
---
<div class="space-y-10">
  <div class="flex flex-wrap gap-3" data-animate>
    {filters.map((filter) => (
      <button
        type="button"
        class="filter-btn rounded-full border px-6 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-[var(--muted)] transition hover:border-[var(--accent)] hover:text-[var(--accent)]"
        data-filter={filter}
      >
        {filter}
      </button>
    ))}
  </div>
  <div id="project-grid" class="grid gap-6 md:grid-cols-2" data-animate>
    {projects.map((project, index) => (
      <div
        class="fade-card"
        data-project
        data-category={project.category}
        style={`transition-delay: ${index * 80}ms;`}
      >
        <ProjectCard {...project} animated={false} />
      </div>
    ))}
  </div>
</div>
<style is:inline>
  .fade-card {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .fade-card[data-hidden='true'] {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
  }

  .filter-btn[aria-pressed='true'] {
    border-color: var(--accent);
    color: var(--accent);
  }
</style>
<script type="module" lang="ts">
  const buttons = Array.from(document.querySelectorAll<HTMLButtonElement>('[data-filter]'));
  const cards = Array.from(document.querySelectorAll<HTMLElement>('[data-project]'));
  let activeFilter: string = 'All';

  const applyFilter = (filter: string) => {
    activeFilter = filter;
    buttons.forEach((btn) => btn.setAttribute('aria-pressed', String(btn.dataset.filter === filter)));
    const visibleCards = cards.filter((card) => {
      const category = card.dataset.category;
      return filter === 'All' || category === filter;
    });
    cards.forEach((card) => {
      card.dataset.hidden = String(!visibleCards.includes(card));
      card.style.transitionDelay = !visibleCards.includes(card)
        ? '0ms'
        : `${visibleCards.indexOf(card) * 80}ms`;
    });
  };

  buttons.forEach((button) => {
    button.addEventListener('click', () => applyFilter(button.dataset.filter ?? 'All'));
  });

  applyFilter(activeFilter);
</script>
