---
import ProjectCard from './ProjectCard.astro';
import type { Project, ProjectCategory } from '../content/data';

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
const filters: Array<'All' | ProjectCategory> = ['All', 'Full-Stack', 'Mobile', 'Web', 'Backend'];
---
<div class="space-y-10">
  <div class="flex flex-wrap gap-3" data-animate>
    {filters.map((filter) => (
      <button
        type="button"
        class="filter-btn rounded-full border border-white/10 bg-surface/10 px-6 py-2 text-[11px] font-semibold uppercase tracking-[0.35em] text-[var(--muted)] transition-all hover:border-[var(--accent)] hover:text-[var(--accent)]"
        data-filter={filter}
        aria-pressed="false"
      >
        {filter}
      </button>
    ))}
  </div>
  <div id="project-grid" class="grid gap-6 md:grid-cols-2" data-animate>
    {projects.map((project, index) => (
      <div
        class="fade-card"
        data-project
        data-category={project.category}
        style={`transition-delay: ${index * 80}ms;`}
      >
        <ProjectCard {...project} animated={false} />
      </div>
    ))}
  </div>
</div>
<style is:inline>
  .fade-card {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .fade-card[data-hidden='true'] {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
  }

  .filter-btn[aria-pressed='true'] {
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: 0 0 25px rgba(79, 195, 247, 0.25);
  }
</style>
<script type="module" lang="ts">
  const buttons = Array.from(document.querySelectorAll('[data-filter]'));
  const cards = Array.from(document.querySelectorAll('[data-project]'));
  let activeFilter = 'All';

  const applyFilter = (filter) => {
    activeFilter = filter;

    buttons.forEach((btn) => {
      if (!(btn instanceof HTMLButtonElement)) return;
      btn.setAttribute('aria-pressed', String(btn.dataset.filter === filter));
    });

    let visibleIndex = 0;
    cards.forEach((card) => {
      if (!(card instanceof HTMLElement)) return;
      const category = card.dataset.category;
      const shouldShow = filter === 'All' || category === filter;
      card.dataset.hidden = String(!shouldShow);
      card.style.transitionDelay = shouldShow ? `${visibleIndex * 80}ms` : '0ms';
      if (shouldShow) visibleIndex += 1;
    });
  };

  buttons.forEach((button) => {
    if (!(button instanceof HTMLButtonElement)) return;
    button.addEventListener('click', () => applyFilter(button.dataset.filter ?? 'All'));
  });

  applyFilter(activeFilter);
</script>
